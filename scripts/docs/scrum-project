#!/bin/bash

# scrum-project - Simple wrapper for Scrum project management
# Usage: scrum-project <command> [options]

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

show_help() {
    echo "Scrum Project Management Tool"
    echo ""
    echo "Usage: $0 <command> [options]"
    echo ""
    echo "Commands:"
    echo "  create <name>         Create a new Scrum project (with repository issues)"
    echo "  create-only <name>    Create a project-only board (draft items, no repo)"
    echo "  configure <num>       Configure items in project #num"
    echo "  add-items <num> <file> Add draft items from JSON file"
    echo "  list                  List your projects"
    echo "  help                  Show this help message"
    echo ""
    echo "Options:"
    echo "  --org <name>      Work with organization projects"
    echo "  --add-issues      Add repository issues (create command)"
    echo ""
    echo "Examples:"
    echo "  $0 create 'Sprint Planning' --add-issues"
    echo "  $0 create-only 'Product Backlog'"
    echo "  $0 add-items 12 backlog.json"
    echo "  $0 configure 12"
    echo "  $0 list --org myorg"
}

case "$1" in
    create)
        shift
        if [ -z "$1" ]; then
            echo -e "${YELLOW}Error: Project name required${NC}"
            echo "Usage: $0 create <project-name> [options]"
            exit 1
        fi
        "$SCRIPT_DIR/create-scrum-project-complete.sh" "$@"
        ;;
        
    create-only)
        shift
        if [ -z "$1" ]; then
            echo -e "${YELLOW}Error: Project name required${NC}"
            echo "Usage: $0 create-only <project-name> [options]"
            exit 1
        fi
        "$SCRIPT_DIR/create-project-only-scrum.sh" "$@"
        ;;
        
    configure)
        shift
        if [ -z "$1" ]; then
            echo -e "${YELLOW}Error: Project number required${NC}"
            echo "Usage: $0 configure <project-number> [options]"
            exit 1
        fi
        "$SCRIPT_DIR/configure-scrum-items.sh" "$@"
        ;;
        
    add-items)
        shift
        if [ -z "$1" ] || [ -z "$2" ]; then
            echo -e "${YELLOW}Error: Project number and items file required${NC}"
            echo "Usage: $0 add-items <project-number> <items-file> [options]"
            exit 1
        fi
        "$SCRIPT_DIR/add-draft-items.sh" "$@"
        ;;
        
    list)
        shift
        OWNER=""
        if [ "$1" = "--org" ] && [ -n "$2" ]; then
            OWNER="--owner $2"
        else
            OWNER="--owner $(gh api user --jq .login)"
        fi
        
        echo -e "${BLUE}Your GitHub Projects:${NC}"
        echo ""
        gh project list $OWNER --limit 20 --format "table"
        ;;
        
    help|--help|-h)
        show_help
        ;;
        
    "")
        show_help
        ;;
        
    *)
        echo -e "${YELLOW}Unknown command: $1${NC}"
        echo ""
        show_help
        exit 1
        ;;
esac